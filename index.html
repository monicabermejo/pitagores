<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unitat 6: Pit√†gores - Dossier v15.5</title>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --error: #c0392b;
            --bg: #fdfdfd;
            --card-bg: #ffffff;
            --text: #333;
            --light-blue: #ebf5fb;
            --selected: #f1c40f;
            
            /* Colores Demostraci√≥n */
            --dem-fill: #aed6f1;
            --dem-stroke: #2c3e50;
            --dem-hypo: #f5b7b1;
            --dem-cat1: #abebc6;
            --dem-cat2: #f9e79f;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }

        /* Header Alegre */
        header {
            background: linear-gradient(135deg, #3498db 0%, #1abc9c 100%);
            color: white;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin: 0;
            font-size: 2rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* Contenedor derecho para firma y botones */
        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .author-tag {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 300;
            letter-spacing: 0.5px;
            font-style: italic;
            margin-right: 15px;
            display: block;
        }
        
        @media (max-width: 600px) {
            .author-tag { display: none; }
        }

        .header-btn {
            background: rgba(255,255,255,0.25);
            border: 2px solid white;
            color: white;
            padding: 5px 15px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .header-btn:hover { 
            background: rgba(255,255,255,1); 
            color: var(--primary);
        }
        
        .btn-reset {
            border-color: #ffcccc;
            background: rgba(192, 57, 43, 0.4);
        }
        .btn-reset:hover {
            background: #c0392b;
            color: white;
            border-color: #c0392b;
        }

        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }

        section {
            background: var(--card-bg);
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 5px solid var(--accent);
            transition: all 0.5s ease;
        }

        /* LOCKED SECTIONS STYLE */
        section.locked-section {
            border-left: 5px solid #bdc3c7;
            opacity: 0.7;
        }
        .section-content {
            display: block;
            animation: slideDown 0.5s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 { color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; justify-content: space-between; }
        h3 { color: var(--accent); margin-top: 2rem; border-bottom: 1px solid #ebf5fb; padding-bottom: 5px; }
        h4 { color: var(--primary); margin-bottom: 0.5rem; font-weight: 600; margin-top: 1.5rem; }

        /* Grids */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        
        @media (max-width: 700px) {
            .grid-2 { grid-template-columns: 1fr; }
        }

        /* Boxes & Inputs */
        .concept-box {
            background-color: var(--light-blue);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #aed6f1;
        }
        
        .theory-review {
            background-color: #e3f2fd;
            border-left: 5px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .theory-review h4 { color: #0d47a1; margin-top: 0; }

        .formula-box {
            background-color: #fff8e1;
            padding: 10px;
            border-left: 4px solid #f1c40f;
            margin: 10px 0;
            font-family: monospace;
            font-size: 1rem;
        }

        .exercise {
            background-color: #fff;
            border: 2px solid #eee;
            padding: 15px;
            border-radius: 10px;
            height: 100%;
        }

        input[type="number"], select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 1rem;
            margin-right: 10px;
        }
        
        input[type="number"] { width: 80px; }

        button.check-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        button.check-btn:hover { background-color: #2980b9; }

        /* MODAL STYLES */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.5); 
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover { color: black; }
        
        .roots-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }
        .roots-table td {
            border: 1px solid #ddd;
            padding: 8px;
            background: #f9f9f9;
        }
        
        /* MINI CALCULATOR STYLES */
        .mini-calc {
            background: #333;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .mini-calc input { width: 80px; text-align: center; }
        .mini-calc button { background: #f39c12; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .mini-calc span { font-weight: bold; font-size: 1.2rem; color: #f1c40f; }

        /* UNLOCK BUTTONS */
        .unlock-btn-container {
            margin-top: 40px;
            text-align: center;
            border-top: 1px dashed #ccc;
            padding-top: 20px;
        }
        .btn-next-section {
            background-color: var(--success);
            color: white;
            padding: 12px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .btn-next-section:hover {
            background-color: #219150;
            transform: scale(1.05);
        }

        /* EXTENSION STYLES */
        .extension-section {
            border: 2px dashed var(--primary);
            background-color: #fcf3cf;
        }
        .btn-expert {
            background: linear-gradient(45deg, #f1c40f, #e67e22);
            font-weight: bold;
            font-size: 1.1rem !important;
            border: none;
            box-shadow: 0 4px 0 #d35400;
            transition: transform 0.1s;
        }
        .btn-expert:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .feedback {
            margin-top: 10px;
            font-weight: bold;
            font-size: 0.9rem;
            min-height: 24px;
        }
        .correct { color: var(--success); }
        .incorrect { color: var(--error); }

        /* CREATIVE BOX */
        .creative-box {
            border: 2px solid #8e44ad;
            background-color: #f4ecf7;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: left;
        }

        /* WELCOME BOX */
        #welcome-screen {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-top: 5px solid var(--accent);
        }

        /* --- DRAG & DROP STYLES --- */
        .dd-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .dd-item { text-align: center; width: 30%; min-width: 150px; }
        .dd-target {
            height: 40px;
            border: 2px dashed #aaa;
            background: #f9f9f9;
            border-radius: 5px;
            margin-top: 10px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-weight: bold; color: var(--primary);
        }
        .dd-target.filled {
            border: 2px solid var(--accent); background: #eaf2f8; color: var(--accent);
        }
        .dd-labels {
            display: flex; justify-content: center; gap: 15px;
            margin-bottom: 20px; padding: 10px; background: #eee; border-radius: 8px;
        }
        .dd-label {
            background: white; border: 1px solid #ccc; padding: 5px 15px;
            border-radius: 20px; cursor: pointer; user-select: none;
        }
        .dd-label.selected {
            background: var(--selected); border-color: #f39c12; transform: scale(1.05);
        }
        .dd-label.hidden { opacity: 0.2; pointer-events: none; }

        /* SVGs & Games */
        .hypo-game-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .hypo-svg {
            cursor: pointer;
            border: 1px solid #eee;
            border-radius: 8px;
            background: white;
            transition: transform 0.2s;
        }
        .hypo-svg:hover { transform: scale(1.05); border-color: var(--accent); }
        .click-line { stroke-width: 5; transition: stroke 0.2s; }
        .click-line:hover { stroke: var(--accent); stroke-width: 8; }

        /* VISUAL PROOF STYLES */
        .proof-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            background: #fafafa;
            padding: 20px;
            border-radius: 10px;
            border: 1px dashed #ccc;
        }
        .proof-box { text-align: center; flex: 1; min-width: 250px; }
        .proof-svg {
            border: 2px solid #333; background: white; border-radius: 4px;
            max-width: 100%; height: auto;
        }
        .proof-text { font-size: 0.9rem; margin-top: 10px; color: #555; max-width: 280px; margin: 10px auto; }

        .visual-problem { text-align: center; }
        .visual-problem svg { max-width: 100%; height: auto; border: 1px solid #eee; border-radius: 8px; }

        /* HISTORY SECTION STYLES */
        .history-btn {
            background-color: #34495e;
            color: #ecf0f1;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1rem;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .history-btn:hover { background-color: #2c3e50; transform: translateY(-2px); }
        .history-content-box {
            background: #fdfefe;
            border: 1px solid #bdc3c7;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 5px solid #8e44ad;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        footer { text-align: center; padding: 2rem; color: #777; font-size: 0.9rem; }
    </style>
</head>
<body>

<header>
    <h1>Unitat 6: Pit√†gores</h1>
    <div class="header-right">
        <div class="author-tag">Created by M√≥nica Bermejo Abell√°n</div>
        <button class="header-btn btn-reset" onclick="resetProgress()" title="Borrar tot i comen√ßar de zero">üóëÔ∏è Reset</button>
        <button class="header-btn" onclick="toggleLanguage()">ES / CA</button>
    </div>
</header>

<div class="container">

    <div id="welcome-screen">
        <h2 style="color:var(--primary); margin-top:0;">Benvinguts a la Unitat 6!</h2>
        <p style="font-size:1.1rem; color:#555;">Esteu preparats per resoldre el repte i convertir-vos en experts?</p>
        <button class="btn-next-section" onclick="startDossier()" style="font-size: 1.3rem; padding: 15px 40px;">Comencem! üöÄ</button>
    </div>

    <section id="sec_1" class="locked-section">
        <h2 data-i18n="b1_title">1. Recordatori <span class="lock-icon" style="display:inline;">üîí</span></h2>
        
        <div class="section-content" style="display:none;" id="content_1">
            <h3 data-i18n="b1_geo_title">1.1 Geometria B√†sica</h3>
            
            <div class="concept-box">
                <p data-i18n="b1_intro_text">Abans de comen√ßar amb Pit√†gores, necessitem revisar dues eines b√†siques de 1r d'ESO.</p>
                <h4 data-i18n="b1_class_title" style="margin-top:0;">Classificaci√≥ de Triangles</h4>
                <p data-i18n="b1_class_desc">Un triangle pot tenir dos noms alhora:</p>
                <ul>
                    <li data-i18n="b1_class_sides">Segons els <strong>costats</strong>: Equil√†ter, Is√≤sceles, Escal√®.</li>
                    <li data-i18n="b1_class_angles">Segons els <strong>angles</strong>: Acutangle, Rectangle, Obtusangle.</li>
                </ul>
                <p><strong style="color:var(--error);" data-i18n="b1_important">IMPORTANT: En aquesta unitat ens centrarem en el Triangle Rectangle (t√© un angle de 90¬∞).</strong></p>
            </div>

            <div class="exercise">
                <h4 data-i18n="ex1_title" style="margin-top:0;">Exercici R√†pid 1</h4>
                <p data-i18n="ex1_q">Si un triangle t√© un angle de 90¬∞ i dos costats iguals, com es diu?</p>
                <select id="ex1_input">
                    <option value="0">---</option>
                    <option value="a" data-i18n="opt_a">Rectangle i Escal√®</option>
                    <option value="b" data-i18n="opt_b">Rectangle i Is√≤sceles</option>
                    <option value="c" data-i18n="opt_c">Obtusangle i Is√≤sceles</option>
                </select>
                <button class="check-btn" onclick="checkEx1()" data-i18n="btn_check">Comprovar</button>
                <div id="ex1_feed" class="feedback"></div>
            </div>

            <h4 data-i18n="b1_sub_angles">1.1.1 Classificaci√≥ de triangles per Angles</h4>
            <div class="grid-3">
                <div class="exercise visual-problem">
                    <svg width="100" height="80" viewBox="0 0 100 80">
                        <polygon points="50,5 90,75 10,75" fill="none" stroke="black" stroke-width="2"/>
                    </svg>
                    <select id="angle_1">
                        <option value="0">---</option>
                        <option value="acut" data-i18n="opt_acut">Acutangle</option>
                        <option value="rect" data-i18n="opt_rect">Rectangle</option>
                        <option value="obt" data-i18n="opt_obt">Obtusangle</option>
                    </select>
                    <span id="f_angle_1"></span>
                </div>
                <div class="exercise visual-problem">
                    <svg width="100" height="80" viewBox="0 0 100 80">
                        <polygon points="20,5 20,75 90,75" fill="none" stroke="black" stroke-width="2"/>
                        <rect x="20" y="65" width="10" height="10" fill="none" stroke="red"/>
                    </svg>
                    <select id="angle_2">
                        <option value="0">---</option>
                        <option value="acut" data-i18n="opt_acut">Acutangle</option>
                        <option value="rect" data-i18n="opt_rect">Rectangle</option>
                        <option value="obt" data-i18n="opt_obt">Obtusangle</option>
                    </select>
                    <span id="f_angle_2"></span>
                </div>
                <div class="exercise visual-problem">
                    <svg width="100" height="80" viewBox="0 0 100 80">
                        <polygon points="10,75 50,75 90,20" fill="none" stroke="black" stroke-width="2"/>
                    </svg>
                    <select id="angle_3">
                        <option value="0">---</option>
                        <option value="acut" data-i18n="opt_acut">Acutangle</option>
                        <option value="rect" data-i18n="opt_rect">Rectangle</option>
                        <option value="obt" data-i18n="opt_obt">Obtusangle</option>
                    </select>
                    <span id="f_angle_3"></span>
                </div>
            </div>
            <div style="text-align:center; margin-bottom: 20px;">
                <button class="check-btn" onclick="checkAngles()" data-i18n="btn_check">Comprovar Angles</button>
            </div>

            <h4 data-i18n="b1_sub1">1.1.2 Classificaci√≥ de triangles per Costats</h4>
            <p data-i18n="dd_instr">Joc: Selecciona una etiqueta i col¬∑loca-la sota el triangle correcte.</p>

            <div class="dd-labels">
                <div class="dd-label" onclick="selectLabel('equilater')" id="lbl_equilater">Equil√†ter</div>
                <div class="dd-label" onclick="selectLabel('isosceles')" id="lbl_isosceles">Is√≤sceles</div>
                <div class="dd-label" onclick="selectLabel('escale')" id="lbl_escale">Escal√®</div>
            </div>

            <div class="dd-container">
                <div class="dd-item">
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <path d="M 50 10 L 80 90 L 20 90 Z" fill="none" stroke="black" stroke-width="3"/>
                        <line x1="35" y1="50" x2="25" y2="55" stroke="red" stroke-width="2"/>
                        <line x1="65" y1="50" x2="75" y2="55" stroke="red" stroke-width="2"/>
                    </svg>
                    <div class="dd-target" onclick="placeLabel('box1')" id="box1" data-correct="isosceles">?</div>
                </div>
                <div class="dd-item">
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <path d="M 20 20 L 90 80 L 10 90 Z" fill="none" stroke="black" stroke-width="3"/>
                    </svg>
                    <div class="dd-target" onclick="placeLabel('box2')" id="box2" data-correct="escale">?</div>
                </div>
                <div class="dd-item">
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <path d="M 50 10 L 90 80 L 10 80 Z" fill="none" stroke="black" stroke-width="3"/>
                        <line x1="30" y1="45" x2="20" y2="45" stroke="blue" stroke-width="2"/>
                        <line x1="70" y1="45" x2="80" y2="45" stroke="blue" stroke-width="2"/>
                        <line x1="50" y1="85" x2="50" y2="75" stroke="blue" stroke-width="2"/>
                    </svg>
                    <div class="dd-target" onclick="placeLabel('box3')" id="box3" data-correct="equilater">?</div>
                </div>
            </div>
            <div id="dd_feedback" class="feedback" style="text-align:center;"></div>

            <h4 data-i18n="b1_sub2">1.1.3 √Ärea i Per√≠metre</h4>
            
            <div class="concept-box">
                <div style="display:flex; align-items:flex-start; gap:20px; flex-wrap:wrap;">
                    <div style="flex:1; min-width: 250px;">
                        <h5 style="margin-top:0;">üé® Per√≠metre (La Tanca)</h5>
                        <p data-i18n="perim_def">√âs la longitud del contorn. Imagina que has de comprar filferro per tancar un jard√≠.</p>
                        <p><strong>Unitats lineals:</strong> $m, cm, km$</p>
                        <p><em>F√≥rmula general: Suma de tots els costats.</em></p>
                    </div>
                    <div style="flex:1; min-width: 250px;">
                        <h5 style="margin-top:0;">üü© √Ärea (La Gespa)</h5>
                        <p data-i18n="area_def">√âs la superf√≠cie de dins. Imagina que has de comprar rotllos de gespa per cobrir el terra.</p>
                        <p><strong>Unitats quadrades:</strong> $m^2, cm^2$</p>
                        <div class="formula-box" style="font-size:0.9rem;">
                            Rectangle: $A = b \cdot h$<br>
                            Triangle: $A = \frac{b \cdot h}{2}$<br>
                            Cercle: $A = \pi \cdot r^2$ ($L = 2\pi r$)
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid-3">
                <div class="exercise">
                    <h5 data-i18n="rev_ex1_title" style="margin-top:0;">A. El Quadrat</h5>
                    <p data-i18n="rev_ex1_desc">Tenim un quadrat de costat 5 cm.</p>
                    <label>Per√≠metre:</label> <input type="number" id="rev_text_1_p"> cm<br>
                    <label>√Ärea:</label> <input type="number" id="rev_text_1_a"> $cm^2$<br>
                    <button class="check-btn" onclick="checkRevText1()" data-i18n="btn_check">Comprovar</button>
                    <div id="feed_rev_text_1" class="feedback"></div>
                </div>

                <div class="exercise">
                    <h5 data-i18n="rev_ex2_title" style="margin-top:0;">B. El Triangle</h5>
                    <p data-i18n="rev_ex2_desc">Un triangle t√© base = 10 m i altura = 4 m.</p>
                    <label>√Ärea:</label> <input type="number" id="rev_text_2_a"> $m^2$<br>
                    <button class="check-btn" onclick="checkRevText2()" data-i18n="btn_check">Comprovar</button>
                    <div id="feed_rev_text_2" class="feedback"></div>
                </div>

                <div class="exercise visual-problem">
                    <h5 data-i18n="rev_p1_title" style="margin-top:0;">C. El Cub</h5>
                    <svg width="120" height="120" viewBox="0 0 150 150">
                        <rect x="10" y="10" width="120" height="120" fill="black"/>
                        <rect x="12" y="12" width="38" height="38" fill="#e74c3c" stroke="black"/>
                        <rect x="52" y="12" width="38" height="38" fill="#ffffff" stroke="black"/>
                        <rect x="92" y="12" width="38" height="38" fill="#3498db" stroke="black"/>
                        <rect x="12" y="52" width="38" height="38" fill="#e67e22" stroke="black"/>
                        <rect x="52" y="52" width="38" height="38" fill="#2ecc71" stroke="black"/>
                        <rect x="92" y="52" width="38" height="38" fill="#f1c40f" stroke="black"/>
                        <rect x="12" y="92" width="38" height="38" fill="#ffffff" stroke="black"/>
                        <rect x="52" y="92" width="38" height="38" fill="#3498db" stroke="black"/>
                        <rect x="92" y="92" width="38" height="38" fill="#e74c3c" stroke="black"/>
                        <path d="M 12 135 L 50 135" stroke="black" marker-end="url(#arrow)"/>
                        <text x="20" y="145" font-size="12">1.5 cm</text>
                    </svg>
                    <p data-i18n="rev_p1_desc_v15">Calcula l'√†rea i el per√≠metre d'una cara d'aquest cub de Rubik.</p>
                    <label>Per√≠metre:</label> <input type="number" id="ans_rev1_p"><br>
                    <label>√Ärea:</label> <input type="number" id="ans_rev1_a"><br>
                    <button class="check-btn" onclick="checkRevVisual1()" data-i18n="btn_check">Comprovar</button>
                    <div id="feed_rev_vis_1" class="feedback"></div>
                </div>

                <div class="exercise visual-problem">
                    <h5 data-i18n="rev_p2_title" style="margin-top:0;">D. El Senyal</h5>
                    <svg width="120" height="120" viewBox="0 0 180 150">
                        <path d="M 10 10 L 150 10 L 80 130 Z" fill="white" stroke="#c0392b" stroke-width="8"/>
                        <text x="80" y="50" text-anchor="middle" font-weight="bold" font-size="14">CEDIU EL</text>
                        <text x="80" y="65" text-anchor="middle" font-weight="bold" font-size="14">PAS</text>
                        <line x1="10" y1="5" x2="150" y2="5" stroke="blue"/>
                        <text x="130" y="25" fill="blue" font-size="20" font-weight="bold">c=60</text>
                        <line x1="80" y1="10" x2="80" y2="130" stroke="green" stroke-dasharray="4"/>
                        <text x="85" y="110" fill="green" font-size="20" font-weight="bold">h=52</text>
                    </svg>
                    <p data-i18n="rev_p2_desc">Senyal triangular equil√†ter.</p>
                    <label>Per√≠metre:</label> <input type="number" id="ans_rev2_p"><br>
                    <label>√Ärea:</label> <input type="number" id="ans_rev2_a"><br>
                    <button class="check-btn" onclick="checkRevVisual2()" data-i18n="btn_check">Comprovar</button>
                    <div id="feed_rev_vis_2" class="feedback"></div>
                </div>

                <div class="exercise visual-problem">
                    <h5 data-i18n="rev_circle_title" style="margin-top:0;">E. La Circumfer√®ncia</h5>
                    <svg width="120" height="120" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="40" stroke="#8e44ad" stroke-width="3" fill="#f3e5f5"/>
                        <line x1="50" y1="50" x2="90" y2="50" stroke="black" stroke-width="2"/>
                        <text x="70" y="40" text-anchor="middle" font-size="12" font-weight="bold">r=5 cm</text>
                    </svg>
                    <p></p>
                    <label>Longitud:</label> <input type="number" id="ans_rev_circle_p"><br>
                    <label>√Ärea:</label> <input type="number" id="ans_rev_circle_a"><br>
                    <button class="check-btn" onclick="checkRevCircle()" data-i18n="btn_check">Comprovar</button>
                    <div id="feed_rev_circle" class="feedback"></div>
                </div>
            </div>

            <h3 data-i18n="roots_title">1.2 L'Arrel Quadrada</h3>
            <div class="concept-box">
                <h4 data-i18n="roots_desc" style="margin-top:0;">L'operaci√≥ contr√†ria al Quadrat</h4>
                <p data-i18n="roots_def">L'arrel quadrada ($\sqrt{x}$) respon a la pregunta: <strong>"Quin nombre multiplicat per ell mateix d√≥na aquest resultat?"</strong></p>
                
                <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap; margin:20px 0;">
                    <button onclick="openRootsModal()" style="background:#8e44ad; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-weight:bold;">
                        üìñ Veure les 15 primeres arrels exactes
                    </button>
                </div>

                <div style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center;">
                    <div class="formula-box">
                        $\sqrt{9} = 3$ <br> <small>(perqu√® $3 \cdot 3 = 9$)</small>
                    </div>
                    <div class="formula-box">
                        $\sqrt{25} = 5$ <br> <small>(perqu√® $5 \cdot 5 = 25$)</small>
                    </div>
                    <div class="formula-box" style="border-left-color: #c0392b;">
                        $\sqrt{10} \approx 3.16$ <br> <small>(No √©s exacte!)</small>
                    </div>
                </div>

                <div class="mini-calc">
                    <span>$\sqrt{x}$ Calculadora:</span>
                    <input type="number" id="calc_input" placeholder="Nombre">
                    <button onclick="calculateRoot()">Calcular</button>
                    <span id="calc_result">?</span>
                </div>
            </div>
            
            <div class="grid-3">
                <div class="exercise">
                    <p>Quant √©s $\sqrt{49}$?</p>
                    <input type="number" id="sq_1">
                    <button class="check-btn" onclick="checkRoot1()">OK</button>
                    <span id="f_sq_1"></span>
                </div>
                <div class="exercise">
                    <p>Quant √©s $\sqrt{81}$?</p>
                    <input type="number" id="sq_2">
                    <button class="check-btn" onclick="checkRoot2()">OK</button>
                    <span id="f_sq_2"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="roots_q3">L'arrel de 15 √©s exacta?</p>
                    <select id="sq_3">
                        <option value="0">---</option>
                        <option value="si">S√≠</option>
                        <option value="no">No</option>
                    </select>
                    <button class="check-btn" onclick="checkRoot3()">OK</button>
                    <span id="f_sq_3"></span>
                </div>
            </div>

            <div class="unlock-btn-container">
                <button class="btn-next-section" onclick="unlockSection(2)" data-i18n="btn_next_sec">He acabat! Seg√ºent Secci√≥ üîì</button>
            </div>
        </div>
    </section>

    <div id="rootsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeRootsModal()">&times;</span>
            <h3 style="color:var(--primary); margin-top:0;">Taula d'Arrels Exactes (1-15)</h3>
            <div style="display:flex; justify-content:space-around;">
                <table class="roots-table">
                    <tr><td>&radic;1 = 1</td></tr>
                    <tr><td>&radic;4 = 2</td></tr>
                    <tr><td>&radic;9 = 3</td></tr>
                    <tr><td>&radic;16 = 4</td></tr>
                    <tr><td>&radic;25 = 5</td></tr>
                </table>
                <table class="roots-table">
                    <tr><td>&radic;36 = 6</td></tr>
                    <tr><td>&radic;49 = 7</td></tr>
                    <tr><td>&radic;64 = 8</td></tr>
                    <tr><td>&radic;81 = 9</td></tr>
                    <tr><td>&radic;100 = 10</td></tr>
                </table>
                <table class="roots-table">
                    <tr><td>&radic;121 = 11</td></tr>
                    <tr><td>&radic;144 = 12</td></tr>
                    <tr><td>&radic;169 = 13</td></tr>
                    <tr><td>&radic;196 = 14</td></tr>
                    <tr><td>&radic;225 = 15</td></tr>
                </table>
            </div>
        </div>
    </div>

    <section id="sec_2" class="locked-section">
        <h2 data-i18n="b2_title">2. Identificaci√≥ Visual <span class="lock-icon">üîí</span></h2>
        
        <div class="section-content" style="display:none;" id="content_2">
            <div class="concept-box">
                <h4 data-i18n="b2_theory_title">Com identificar les parts?</h4>
                <ul>
                    <li data-i18n="b2_catet">üî¥ <strong>Catets:</strong> S√≥n els dos costats que es toquen formant l'angle recte. Formen una "L".</li>
                    <li data-i18n="b2_hypo">üîµ <strong>Hipotenusa:</strong> √âs el costat oposat a l'angle recte. No el toca. Sempre √©s el costat m√©s llarg.</li>
                </ul>
            </div>

            <p data-i18n="b2_desc">Fes clic a la <strong>Hipotenusa</strong>. Fixa't on √©s l'angle recte.</p>
            
            <div class="hypo-game-container">
                <svg width="120" height="120" viewBox="0 0 100 100" class="hypo-svg">
                    <path d="M 10 10 L 10 90 L 90 90 Z" fill="none" stroke="transparent"/>
                    <line x1="10" y1="10" x2="10" y2="90" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                    <line x1="10" y1="90" x2="90" y2="90" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                    <line x1="10" y1="10" x2="90" y2="90" stroke="#333" stroke-width="3" class="click-line" onclick="correct(this)"/>
                    <rect x="10" y="75" width="15" height="15" fill="none" stroke="#333"/>
                </svg>
                <svg width="120" height="120" viewBox="0 0 100 100" class="hypo-svg">
                    <g transform="rotate(45, 50, 50)">
                        <line x1="20" y1="20" x2="20" y2="80" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                        <line x1="20" y1="80" x2="80" y2="80" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                        <line x1="20" y1="20" x2="80" y2="80" stroke="#333" stroke-width="3" class="click-line" onclick="correct(this)"/>
                        <rect x="20" y="65" width="15" height="15" fill="none" stroke="#333"/>
                    </g>
                </svg>
                <svg width="120" height="120" viewBox="0 0 100 100" class="hypo-svg">
                    <g transform="rotate(110, 50, 50) translate(10, 10)">
                        <line x1="0" y1="0" x2="60" y2="0" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                        <line x1="0" y1="0" x2="0" y2="40" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                        <line x1="60" y1="0" x2="0" y2="40" stroke="#333" stroke-width="3" class="click-line" onclick="correct(this)"/>
                        <rect x="0" y="0" width="10" height="10" fill="none" stroke="#333"/>
                    </g>
                </svg>
                <svg width="120" height="120" viewBox="0 0 100 100" class="hypo-svg">
                    <g transform="rotate(200, 50, 50) translate(20, 20)">
                        <line x1="0" y1="0" x2="50" y2="0" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                        <line x1="0" y1="0" x2="0" y2="70" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                        <line x1="50" y1="0" x2="0" y2="70" stroke="#333" stroke-width="3" class="click-line" onclick="correct(this)"/>
                        <rect x="0" y="0" width="10" height="10" fill="none" stroke="#333"/>
                    </g>
                </svg>
                <svg width="120" height="120" viewBox="0 0 100 100" class="hypo-svg">
                    <g transform="translate(60, 80) rotate(160)">
                        <line x1="0" y1="0" x2="0" y2="80" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                        <line x1="0" y1="0" x2="20" y2="0" stroke="#333" stroke-width="3" class="click-line" onclick="wrong(this)"/>
                        <line x1="0" y1="80" x2="20" y2="0" stroke="#333" stroke-width="3" class="click-line" onclick="correct(this)"/>
                        <rect x="0" y="0" width="10" height="10" fill="none" stroke="#333"/>
                    </g>
                </svg>
            </div>
            <p id="game_msg" style="text-align:center; font-weight:bold; min-height:20px;"></p>

            <div class="unlock-btn-container">
                <button class="btn-next-section" onclick="unlockSection(3)" data-i18n="btn_next_sec">He acabat! Seg√ºent Secci√≥ üîì</button>
            </div>
        </div>
    </section>

    <section id="sec_3" class="locked-section">
        <h2 data-i18n="b3_title">3. El Teorema de Pit√†gores <span class="lock-icon">üîí</span></h2>

        <div class="section-content" style="display:none;" id="content_3">
            <h3 data-i18n="hist_main_title">üèõÔ∏è Pit√†gores: Mite i Llegenda</h3>
            <p data-i18n="hist_intro">La Germandat Pitag√≤rica era una mena de "secta" matem√†tica. Tenien normes molt estranyes i secrets perillosos. Fes clic per descobrir-los.</p>
            
            <div class="grid-2">
                <button class="history-btn" onclick="toggleHistory('h_beans')">
                    ü•ó <span data-i18n="hist_btn_1">El Misteri de les Faves</span>
                </button>
                <button class="history-btn" onclick="toggleHistory('h_death')">
                    üåä <span data-i18n="hist_btn_2">Un Secret Mortal</span>
                </button>
            </div>

            <div id="h_beans" class="history-content-box" style="display:none;">
                <h4 data-i18n="hist_beans_t">La Prohibici√≥ Sagrada</h4>
                <p data-i18n="hist_beans_d">Els pitag√≤rics eren vegetarians, per√≤ tenien una norma estricta: <strong>"No mengis faves!"</strong>. Creien que les faves contenien les √†nimes dels morts o que s'assemblaven massa als √©ssers humans. La llegenda diu que Pit√†gores va morir perqu√®, fugint d'uns enemics, es va trobar un camp de faves i es va negar a creuar-lo per no trepitjar-las, i all√† el van atrapar.</p>
            </div>

            <div id="h_death" class="history-content-box" style="display:none;">
                <h4 data-i18n="hist_death_t">El Crim d'Hipaso</h4>
                <p data-i18n="hist_death_d">Els pitag√≤rics creien que "tot √©s nombre" (fraccions exactes). Per√≤ un alumne, Hipaso de Metapont, va descobrir que l'arrel de 2 ($\sqrt{2}$) no es podia escriure com una fracci√≥. Aix√≤ destru√Øa la seva teoria del m√≥n perfecte. Diu la llegenda que, per mantenir el secret, els altres alumnes <strong>el van llan√ßar per la borda d'un vaixell</strong> al mig del mar.</p>
            </div>
            <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

            <h3 data-i18n="vproof_title">Demostraci√≥ Visual (Sense Paraules)</h3>
            <p data-i18n="vproof_desc">Observa els dos quadrats grans. S√≥n iguals. Qu√® passa amb l'espai buit?</p>

            <div class="proof-container">
                <div class="proof-box">
                    <svg viewBox="0 0 100 100" class="proof-svg" width="250" height="250">
                        <polygon points="0,0 40,0 0,60" fill="var(--dem-fill)" stroke="var(--dem-stroke)" stroke-width="0.5"/>
                        <polygon points="40,0 100,0 100,40" fill="var(--dem-fill)" stroke="var(--dem-stroke)" stroke-width="0.5"/>
                        <polygon points="100,40 100,100 60,100" fill="var(--dem-fill)" stroke="var(--dem-stroke)" stroke-width="0.5"/>
                        <polygon points="60,100 0,100 0,60" fill="var(--dem-fill)" stroke="var(--dem-stroke)" stroke-width="0.5"/>
                        <polygon points="40,0 100,40 60,100 0,60" fill="var(--dem-hypo)" stroke="none"/>
                        <text x="50" y="50" dominant-baseline="middle" text-anchor="middle" font-size="8" font-weight="bold" fill="#c0392b">h¬≤</text>
                    </svg>
                    <div class="proof-text" data-i18n="vproof_txt1">Si posem els triangles a les cantonades... queda el quadrat de la HIPOTENUSA ($h^2$).</div>
                </div>

                <div class="proof-box">
                    <svg viewBox="0 0 100 100" class="proof-svg" width="250" height="250">
                        <rect x="0" y="0" width="40" height="40" fill="var(--dem-cat1)" stroke="none"/>
                        <rect x="40" y="40" width="60" height="60" fill="var(--dem-cat2)" stroke="none"/>
                        <polygon points="40,0 100,0 100,40 40,40" fill="var(--dem-fill)" stroke="var(--dem-stroke)" stroke-width="0.5"/>
                        <line x1="40" y1="0" x2="100" y2="40" stroke="var(--dem-stroke)" stroke-width="0.5"/>
                        <polygon points="0,40 40,40 40,100 0,100" fill="var(--dem-fill)" stroke="var(--dem-stroke)" stroke-width="0.5"/>
                        <line x1="0" y1="40" x2="40" y2="100" stroke="var(--dem-stroke)" stroke-width="0.5"/>
                        <text x="20" y="20" dominant-baseline="middle" text-anchor="middle" font-size="8" font-weight="bold" fill="#145a32">c‚ÇÅ¬≤</text>
                        <text x="70" y="70" dominant-baseline="middle" text-anchor="middle" font-size="10" font-weight="bold" fill="#9a7d0a">c‚ÇÇ¬≤</text>
                    </svg>
                    <div class="proof-text" data-i18n="vproof_txt2">Si ajuntem els triangles... queden els quadrats dels CATETS ($c_1^2$ i $c_2^2$).</div>
                </div>
            </div>

            <div class="concept-box" style="text-align: center;">
                <p data-i18n="vproof_concl"><strong>Conclusi√≥:</strong> L'espai buit √©s el mateix.</p>
                <h3 style="margin:0;">$$h^2 = c_1^2 + c_2^2$$</h3>
                <p data-i18n="b3_trans">"L'√†rea del quadrat gran (hipotenusa) √©s igual a la suma de les √†rees dels dos quadrats petits (catets)."</p>
            </div>

            <div class="concept-box" style="text-align: center;">
                <h4 style="margin-top:0;" data-i18n="calc_formulas_title">Guia de C√†lcul</h4>
                <div style="display:flex; justify-content:space-around; flex-wrap:wrap; gap:10px;">
                    <div style="padding:15px; border:2px solid #27ae60; border-radius:10px; background:white; min-width:300px;">
                        <p style="margin:0; color:#27ae60; font-weight:bold;" data-i18n="calc_hypo_q">Busques la HIPOTENUSA?</p>
                        <p style="margin:10px 0; font-size:1.2rem;">$h = \sqrt{c_1^2 + c_2^2}$</p>
                        <p style="margin:0; font-weight:bold;" data-i18n="calc_hypo_tip">SUMEM (+)</p>
                    </div>
                    <div style="padding:15px; border:2px solid #c0392b; border-radius:10px; background:white; min-width:300px;">
                        <p style="margin:0; color:#c0392b; font-weight:bold;" data-i18n="calc_cat_q">Busques un CATET?</p>
                        <p style="margin:10px 0; font-size:1.2rem;">$c = \sqrt{h^2 - c_{\text{conegut}}^2}$</p>
                        <p style="margin:0; font-weight:bold;" data-i18n="calc_cat_tip">RESTEM (-)</p>
                    </div>
                </div>
            </div>

            <h3 data-i18n="b3_drill_title">Pr√†ctica de C√†lcul</h3>
            <div class="grid-3">
                <div class="exercise"><p>1. $c_1=3, c_2=4$. <br>Troba $h$.</p><input type="number" id="c_1"> <span id="r_1"></span></div>
                <div class="exercise"><p>2. $h=10, c=8$. <br>Troba $c$.</p><input type="number" id="c_2"> <span id="r_2"></span></div>
                <div class="exercise"><p>3. $c_1=5, c_2=12$. <br>Troba $h$.</p><input type="number" id="c_3"> <span id="r_3"></span></div>
                <div class="exercise"><p>4. $h=13, c=12$. <br>Troba $c$.</p><input type="number" id="c_4"> <span id="r_4"></span></div>
                <div class="exercise"><p>5. $c_1=6, c_2=8$. <br>Troba $h$.</p><input type="number" id="c_5"> <span id="r_5"></span></div>
                <div class="exercise"><p>6. $h=15, c=9$. <br>Troba $c$.</p><input type="number" id="c_6"> <span id="r_6"></span></div>
            </div>
            <div style="text-align:center;">
                <button class="check-btn" onclick="checkDrill()" data-i18n="btn_check">Comprovar Tot</button>
            </div>

            <div class="unlock-btn-container">
                <button class="btn-next-section" onclick="unlockSection(4)" data-i18n="btn_next_sec">He acabat! Seg√ºent Secci√≥ üîì</button>
            </div>
        </div>
    </section>

    <section id="sec_4" class="locked-section">
        <h2 data-i18n="b4_title">4. Problemes Reals <span class="lock-icon">üîí</span></h2>
        
        <div class="section-content" style="display:none;" id="content_4">
            <p data-i18n="b4_intro">Resol aquests 14 problemes. Fes un dibuix al teu quadern si ho necessites.</p>
            
            <div class="grid-2">
                <div class="exercise">
                    <p data-i18n="rp_1_txt">1. Una escala de 5m es recolza a la paret. El peu est√† a 3m de la paret. A quina altura arriba l'escala?</p>
                    <input type="number" id="rp_1"> <span id="f_rp_1"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_2_txt">2. Un camp de futbol fa 90m x 120m. Quant mesura la diagonal que corre l'√†rbitre d'un c√≥rner a l'altre?</p>
                    <input type="number" id="rp_2"> <span id="f_rp_2"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_3_txt">3. Estic al parc d'aventures a punt de llan√ßar-me per una tirolina. La plataforma de sortida est√† a la copa d'un arbre de 15 metres d'altura. El meu instructor m'espera a baix, a una dist√†ncia de 8 metres del tronc de l'arbre. Quants metres recorrer√© volant pel cable?</p>
                    <input type="number" id="rp_3"> <span id="f_rp_3"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_4_txt">4. Al skatepark del barri han constru√Øt una rampa gegant. La superf√≠cie per on patines (la rampa inclinada) fa 5 metres de llargada, i quan arribes a dalt de tot est√†s a 3 metres d'altura del terra. Quina dist√†ncia horitzontal ocupa aquesta rampa a terra?</p>
                    <input type="number" id="rp_4"> <span id="f_rp_4"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_5_txt">5. Vull comprar una televisi√≥ nova per la meva habitaci√≥. A la caixa posa que √©s de 50 polzades (aix√≤ √©s la diagonal de la pantalla). Si agafo la cinta m√®trica i veig que l'amplada √©s de 40 polzades, quina altura t√© la pantalla?</p>
                    <input type="number" id="rp_5"> <span id="f_rp_5"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_6_txt">6. Per anar a l'institut, la Maria sempre fa el mateix cam√≠: camina 300 metres cap al Nord i despr√©s gira i camina 400 metres cap a l'Est. Avui s'ha llevat tard i decideix travessar la gespa del parc en l√≠nia recta (la diagonal). Quants metres caminar√† avui?</p>
                    <input type="number" id="rp_6"> <span id="f_rp_6"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_7_txt">7. Hem anat de c√†mping i estem muntant una tenda de campanya tipus 'tipi'. T√© un pal central que fa 2 metres d'alt. Hem de clavar els tensors (cordes) al terra a una dist√†ncia de 1.5 metres del pal. Quina longitud ha de tenir la corda tensa?</p>
                    <input type="number" id="rp_7"> <span id="f_rp_7"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_8_txt">8. Est√†s fent volar un estel a la platja i has deixat anar 17 metres de fil. Just en aquest moment, l'estel est√† volant exactament a sobre d'una font que es troba a 8 metres d'on ets tu. A quina altura est√† volant l'estel?</p>
                    <input type="number" id="rp_8"> <span id="f_rp_8"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_9_txt">9. Un enginyer ha de subjectar una gran antena de r√†dio que fa 24 metres d'altura. Vol posar un cable de seguretat des de la punta de dalt fins a un bloc de formig√≥ que est√† a 7 metres de la base. Quants metres de cable necessita comprar?</p>
                    <input type="number" id="rp_9"> <span id="f_rp_9"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_10_txt">10. Tenim un problema amb la mudan√ßa. Tenim un armari tombat a terra que fa 2.4 metres d'alt i 0.7 metres de fons. El sostre de l'habitaci√≥ est√† a 2.6 metres. Si intentem aixecar l'armari posant-lo dret, la diagonal tocar√† en el techo? Calcula quant mesura la diagonal de l'armari.</p>
                    <input type="number" id="rp_10"> <span id="f_rp_10"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_11_txt">11. T'has comprat una funda per a la teva nova tablet. La pantalla mide 12 cm de ancho y 9 cm de alto. El fabricante de fundes te pide la medida de la diagonal para saber si cabe. ¬øCu√°ntos cm hace la diagonal?</p>
                    <input type="number" id="rp_11"> <span id="f_rp_11"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_12_txt">12. √âs de nit i un fanal del carrer de 4 metres d'altura projecta una ombra molt llarga a terra, de 3 metres. Si hagu√©ssim de tirar un fil des de la bombeta del fanal fins a la punta de l'ombra, quant mesuraria?</p>
                    <input type="number" id="rp_12"> <span id="f_rp_12"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_13_txt">13. El pare vol saber si el seu cotxe nou hi cap en diagonal a la pla√ßa de p√†rquing. La pla√ßa fa 2.5 metres d'ample i 6 metres de llarg. Quina √©s la dist√†ncia m√†xima en diagonal que hi ha a la pla√ßa?</p>
                    <input type="number" id="rp_13"> <span id="f_rp_13"></span>
                </div>
                <div class="exercise">
                    <p data-i18n="rp_14_txt">14. L'avi t√© un hort rectangular tancat. Sabem que la diagonal que creua l'hort fa 10 metres i que un dels costats fa 6 metres. L'avi vol saber quants metres fa l'altre costat per plantar-hi tomaqueres. Calcula-ho.</p>
                    <input type="number" id="rp_14"> <span id="f_rp_14"></span>
                </div>
            </div>
            <div style="text-align:center;">
                <button class="check-btn" onclick="checkRealText()" data-i18n="btn_check">Comprovar Problemes</button>
            </div>

            <div class="creative-box">
                <h3 data-i18n="b4_challenge_title">üåü Activitat Avaluable: Sigueu els Professors!</h3>
                
                <div style="text-align: left; margin-top: 15px;">
                    <p data-i18n="b4_challenge_desc">
                        <strong>Fase 1: Parelles.</strong> Cadasc√∫ inventa 1 problema i el company el resol.<br><br>
                        <strong>Fase 2: Grups de 4.</strong> Trieu el millor problema dels 4.<br><br>
                        <strong>Fase 3: Preparaci√≥.</strong> Poliu l'enunciat i la soluci√≥.<br><br>
                        <strong>Fase 4: Pissarra.</strong> Sortiu a explicar-lo com a professors: plantegeu, pregunteu a la classe i resoleu pas a pas.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section class="extension-section" style="text-align:center;">
        <h3 style="margin-top:0;" data-i18n="ext_title">üöÄ Nivell Expert: Ternes Pitag√≤riques</h3>
        <p data-i18n="ext_desc">Has acabat tots els exercicis? Descobreix el secret dels egipcis per calcular sense calculadora.</p>
        <button class="check-btn btn-expert" onclick="toggleExtension()" data-i18n="ext_btn_unlock" id="btn_expert">Desbloquejar Nivell Expert</button>

        <div id="extension-content" style="display:none; text-align:left; margin-top:20px; border-top:1px solid #ccc; padding-top:20px;">
            
            <div class="concept-box" style="background-color: #fef9e7;">
                <h4 data-i18n="ext_hist_title">Els Egipcis i la Corda de 12 Nusos</h4>
                <p data-i18n="ext_hist_txt">Fa milers d'anys, els agrimensores egipcis (els "estiradors de corda") feien servir una corda amb 12 nusos a la mateixa dist√†ncia. Si formaven un triangle posant 3 nusos en un costat, 4 en l'altre i 5 a la diagonal, aconseguien un angle recte perfecte per construir pir√†mides! Aix√≤ √©s la terna (3, 4, 5).</p>
            </div>

            <div class="concept-box">
                <h4 data-i18n="ext_fam_title">Fam√≠lies de Ternes</h4>
                <p data-i18n="ext_fam_prim"><strong>Ternes Primitives:</strong> S√≥n els "pares" de totes les altres. Les m√©s famoses s√≥n (3, 4, 5), (5, 12, 13) i (8, 15, 17).</p>
                <p data-i18n="ext_fam_deriv"><strong>Ternes Derivades:</strong> Si agafes una terna primitiva i multipliques els seus tres n√∫meros pel mateix nombre (x2, x3, x10...), obtens una nova terna que tamb√© funciona.</p>
            </div>

            <div class="exercise">
                <h4 data-i18n="ext_chal_title">El Repte dels Egipcis</h4>
                <p data-i18n="ext_chal_desc">Si la terna (3, 4, 5) funciona... qu√® passa si la multipliquem per 2? Calcula els costats resultants.</p>
                3 x 2 = <input type="number" id="t_1" style="width:50px"><br>
                4 x 2 = <input type="number" id="t_2" style="width:50px"><br>
                5 x 2 = <input type="number" id="t_3" style="width:50px"><br>
                <button class="check-btn" onclick="checkTripleMulti()" data-i18n="btn_check">Comprovar</button>
                <p id="fb_t1" class="feedback"></p>
            </div>

            <div class="exercise">
                <h4 data-i18n="ext_lab_title">Laboratori de Ternes</h4>
                <p data-i18n="ext_lab_desc">Introdueix 3 nombres i et dir√© si formen un triangle rectangle perfecte.</p>
                <input type="number" id="t_user_a" placeholder="a"> 
                <input type="number" id="t_user_b" placeholder="b"> 
                <input type="number" id="t_user_c" placeholder="c">
                <button class="check-btn" onclick="checkUserTriple()" data-i18n="ext_lab_btn">Analitzar</button>
                <div id="fb_user_triple" class="feedback"></div>
            </div>
        </div>
    </section>

</div>

<script>
    // --- TRANSLATIONS & LOGIC ---
    const t = {
        ca: {
            b1_title: "1. Recordatori",
            b1_geo_title: "1.1 Geometria B√†sica",
            b1_intro_text: "Abans de comen√ßar amb Pit√†gores, necessitem revisar dues eines b√†siques de 1r d'ESO.",
            b1_class_title: "Classificaci√≥ de Triangles",
            b1_class_desc: "Un triangle pot tenir dos noms alhora:",
            b1_class_sides: "Segons els <strong>costats</strong>: Equil√†ter, Is√≤sceles, Escal√®.",
            b1_class_angles: "Segons els <strong>angles</strong>: Acutangle, Rectangle, Obtusangle.",
            b1_important: "IMPORTANT: En aquesta unitat ens centrarem en el Triangle Rectangle (t√© un angle de 90¬∞).",
            ex1_title: "Exercici R√†pid 1",
            ex1_q: "Si un triangle t√© un angle de 90¬∞ i dos costats iguals, com es diu?",
            opt_a: "Rectangle i Escal√®",
            opt_b: "Rectangle i Is√≤sceles",
            opt_c: "Obtusangle i Is√≤sceles",
            b1_sub_angles: "1.1.1 Classificaci√≥ de triangles per Angles",
            opt_acut: "Acutangle",
            opt_rect: "Rectangle",
            opt_obt: "Obtusangle",
            b1_sub1: "1.1.2 Classificaci√≥ de triangles per Costats",
            dd_instr: "Joc: Selecciona una etiqueta i col¬∑loca-la sota el triangle correcte.",
            perim_def: "√âs la longitud del contorn. Imagina que has de comprar filferro per tancar un jard√≠.",
            area_def: "√âs la superf√≠cie de dins. Imagina que has de comprar rotllos de gespa per cobrir el terra.",
            b1_sub2: "1.1.3 √Ärea i Per√≠metre",
            rev_ex1_title: "A. El Quadrat",
            rev_ex1_desc: "Tenim un quadrat de costat 5 cm.",
            rev_ex2_title: "B. El Triangle",
            rev_ex2_desc: "Un triangle t√© base = 10 m i altura = 4 m.",
            rev_p1_title: "C. El Cub",
            rev_p1_desc_v15: "Calcula l'√†rea i el per√≠metre d'una cara d'aquest cub de Rubik.",
            rev_p2_title: "D. El Senyal",
            rev_p2_desc: "Senyal triangular equil√†ter.",
            rev_circle_title: "E. La Circumfer√®ncia",
            rev_circle_desc: "Usa $\\pi = 3.14$",
            // ROOTS
            roots_title: "1.2 L'Arrel Quadrada",
            roots_desc: "L'operaci√≥ contr√†ria al Quadrat",
            roots_def: "L'arrel quadrada ($\\sqrt{x}$) respon a la pregunta: <strong>\"Quin nombre multiplicat per ell mateix d√≥na aquest resultat?\"</strong>",
            roots_q3: "L'arrel de 15 √©s exacta?",
            // HIST
            hist_main_title: "üèõÔ∏è Pit√†gores: Mite i Llegenda",
            hist_intro: "La Germandat Pitag√≤rica era una mena de \"secta\" matem√†tica. Tenien normes molt estranyes i secrets perillosos. Fes clic per descobrir-los.",
            hist_btn_1: "El Misteri de les Faves",
            hist_btn_2: "Un Secret Mortal",
            hist_beans_t: "La Prohibici√≥ Sagrada",
            hist_beans_d: "Els pitag√≤rics eren vegetarians, per√≤ tenien una norma estricta: <strong>\"No mengis faves!\"</strong>. Creien que les faves contenien les √†nimes dels morts o que s'assemblaven massa als √©ssers humans. La llegenda diu que Pit√†gores va morir perqu√®, fugint d'uns enemics, es va trobar un camp de faves i es va negar a creuar-lo per no trepitjar-las, i all√† el van atrapar.",
            hist_death_t: "El Crim d'Hipaso",
            hist_death_d: "Els pitag√≤rics creien que \"tot √©s nombre\" (fraccions exactes). Per√≤ un alumne, Hipaso de Metapont, va descobrir que l'arrel de 2 ($\\sqrt{2}$) no es podia escriure com una fracci√≥. Aix√≤ destru√Øa la seva teoria del m√≥n perfecte. Diu la llegenda que, per mantenir el secret, els altres alumnes <strong>el van llan√ßar per la borda d'un vaixell</strong> al mig del mar.",
            // ANATOMY
            b2_title: "2. Identificaci√≥ Visual",
            b2_desc: "Fes clic a la Hipotenusa. Fixa't on √©s l'angle recte.",
            b2_theory_title: "Com identificar les parts?",
            b2_catet: "üî¥ <strong>Catets:</strong> S√≥n els dos costats que es toquen formant l'angle recte. Formen una \"L\".",
            b2_hypo: "üîµ <strong>Hipotenusa:</strong> √âs el costat oposat a l'angle recte. No el toca. Sempre √©s el costat m√©s llarg.",
            b3_title: "3. El Teorema de Pit√†gores",
            vproof_title: "Demostraci√≥ Visual (Sense Paraules)",
            vproof_desc: "Observa els dos quadrats grans. S√≥n iguals. Qu√® passa amb l'espai buit?",
            vproof_concl: "Conclusi√≥: L'espai buit √©s el mateix.",
            vproof_txt1: "Si posem els triangles a les cantonades... queda el quadrat de la HIPOTENUSA ($h^2$).",
            vproof_txt2: "Si ajuntem els triangles... queden els quadrats dels CATETS ($c_1^2$ i $c_2^2$).",
            b3_trans: "\"L'√†rea del quadrat gran (hipotenusa) √©s igual a la suma de les √†rees dels dos quadrats petits (catets).\"",
            calc_formulas_title: "Guia de C√†lcul",
            calc_hypo_q: "Busques la HIPOTENUSA?",
            calc_hypo_tip: "SUMEM (+)",
            calc_cat_q: "Busques un CATET?",
            calc_cat_tip: "RESTEM (-)",
            b3_drill_title: "Pr√†ctica de C√†lcul",
            b4_title: "4. Problemes Reals",
            b4_intro: "Resol aquests 14 problemes. Fes un dibuix al teu quadern si ho necessites.",
            btn_check: "Comprovar",
            ok: "Correcte!",
            ko: "Torna-ho a provar",
            b4_challenge_title: "üåü Activitat Avaluable: Sigueu els Professors!",
            b4_challenge_desc: "<strong>Fase 1: Parelles.</strong> Cadasc√∫ inventa 1 problema i el company el resol.<br><br><strong>Fase 2: Grups de 4.</strong> Trieu el millor problema dels 4.<br><br><strong>Fase 3: Preparaci√≥.</strong> Poliu l'enunciat i la soluci√≥.<br><br><strong>Fase 4: Pissarra.</strong> Sortiu a explicar-lo com a professors: plantegeu, pregunteu a la classe i resoleu pas a pas.",
            ext_title: "üöÄ Nivell Expert: Ternes Pitag√≤riques",
            ext_desc: "Has acabat tots els exercicis? Descobreix el secret dels egipcis per calcular sense calculadora.",
            ext_btn_unlock: "Desbloquejar Nivell Expert",
            ext_hist_title: "Els Egipcis i la Corda de 12 Nusos",
            ext_hist_txt: "Fa milers d'anys, els agrimensores egipcis (els \"estiradors de corda\") feien servir una corda amb 12 nusos a la mateixa dist√†ncia. Si formaven un triangle posant 3 nusos en un costat, 4 en l'altre i 5 a la diagonal, aconseguien un angle recte perfecte per construir pir√†mides! Aix√≤ √©s la terna (3, 4, 5).",
            ext_fam_title: "Fam√≠lies de Ternes",
            ext_fam_prim: "<strong>Ternes Primitives:</strong> S√≥n els \"pares\" de totes les altres. Les m√©s famoses s√≥n (3, 4, 5), (5, 12, 13) i (8, 15, 17).",
            ext_fam_deriv: "<strong>Ternes Derivades:</strong> Si agafes una terna primitiva i multipliques els seus tres n√∫meros pel mateix nombre (x2, x3, x10...), obtens una nova terna que tamb√© funciona.",
            ext_lab_title: "Laboratori de Ternes",
            ext_lab_desc: "Introdueix 3 nombres i et dir√© si formen un triangle rectangle perfecte.",
            ext_lab_btn: "Analitzar",
            ext_chal_title: "El Repte dels Egipcis",
            ext_chal_desc: "Si la terna (3, 4, 5) funciona... qu√® passa si la multipliquem per 2? Calcula els costats resultants.",
            ext_chal_concl: "‚úÖ Molt b√©! Has trobat una derivada multiplicant la terna primitiva per 2.",
            rp_1_txt: "1. Una escala de 5m es recolza a la paret. El peu est√† a 3m de la paret. A quina altura arriba l'escala?",
            rp_2_txt: "2. Un camp de futbol fa 90m x 120m. Quant mesura la diagonal que corre l'√†rbitre d'un c√≥rner a l'altre?",
            rp_3_txt: "3. Estic al parc d'aventures a punt de llan√ßar-me per una tirolina. La plataforma de sortida est√† a la copa d'un arbre de 15 metres d'altura. El meu instructor m'espera a baix, a una dist√†ncia de 8 metres del tronc de l'arbre. Quants metres recorrer√© volant pel cable?",
            rp_4_txt: "4. Al skatepark del barri han constru√Øt una rampa gegant. La superf√≠cie per on patines (la rampa inclinada) fa 5 metres de llargada, i quan arribes a dalt de tot est√†s a 3 metres d'altura del terra. Quina dist√†ncia horitzontal ocupa aquesta rampa a terra?",
            rp_5_txt: "5. Vull comprar una televisi√≥ nova per la meva habitaci√≥. A la caixa posa que √©s de 50 polzades (aix√≤ √©s la diagonal de la pantalla). Si agafo la cinta m√®trica i veig que l'amplada √©s de 40 polzades, quina altura t√© la pantalla?",
            rp_6_txt: "6. Per anar a l'institut, la Maria sempre fa el mateix cam√≠: camina 300 metres cap al Nord i despr√©s gira i camina 400 metres cap a l'Est. Avui s'ha llevat tard i decideix travessar la gespa del parc en l√≠nia recta (la diagonal). Quants metres caminar√† avui?",
            rp_7_txt: "7. Hem anat de c√†mping i estem muntant una tenda de campanya tipus 'tipi'. T√© un pal central que fa 2 metres d'alt. Hem de clavar els tensors (cordes) al terra a una dist√†ncia de 1.5 metres del pal. Quina longitud ha de tenir la corda tensa?",
            rp_8_txt: "8. Est√†s fent volar un estel a la platja i has deixat anar 17 metres de fil. Just en aquest moment, l'estel est√† volant exactament a sobre d'una font que es troba a 8 metres d'on ets tu. A quina altura est√† volant l'estel?",
            rp_9_txt: "9. Un enginyer ha de subjectar una gran antena de r√†dio que fa 24 metres d'altura. Vol posar un cable de seguretat des de la punta de dalt fins a un bloc de formig√≥ que est√† a 7 metres de la base. Quants metres de cable necessita comprar?",
            rp_10_txt: "10. Tenim un problema amb la mudan√ßa. Tenim un armari tombat a terra que fa 2.4 metres d'alt i 0.7 metres de fons. El sostre de l'habitaci√≥ est√† a 2.6 metres. Si intentem aixecar l'armari posant-lo dret, la diagonal tocar√† en el techo? Calcula quant mesura la diagonal de l'armari.",
            rp_11_txt: "11. T'has comprat una funda per a la teva nova tablet. La pantalla mide 12 cm de ancho y 9 cm de alto. El fabricante de fundes te pide la medida de la diagonal para saber si cabe. ¬øCu√°ntos cm hace la diagonal?",
            rp_12_txt: "12. √âs de nit i un fanal del carrer de 4 metres d'altura projecta una ombra molt llarga a terra, de 3 metres. Si hagu√©ssim de tirar un fil des de la bombeta del fanal fins a la punta de l'ombra, quant mesuraria?",
            rp_13_txt: "13. El pare vol saber si el seu cotxe nou hi cap en diagonal a la pla√ßa de p√†rquing. La pla√ßa fa 2.5 metres d'ample i 6 metres de llarg. Quina √©s la dist√†ncia m√†xima en diagonal que hi ha a la pla√ßa?",
            rp_14_txt: "14. L'avi t√© un hort rectangular tancat. Sabem que la diagonal que creua l'hort fa 10 metres i que un dels costats fa 6 metres. L'avi vol saber quants metres fa l'altre costat per plantar-hi tomaqueres. Calcula-ho.",
            btn_next_sec: "He acabat! Seg√ºent Secci√≥ üîì"
        },
        es: {
            b1_title: "1. Recordatorio",
            b1_geo_title: "1.1 Geometr√≠a B√°sica",
            b1_intro_text: "Antes de empezar con Pit√°goras, necesitamos revisar dos herramientas b√°sicas de 1¬∫ de ESO.",
            b1_class_title: "Clasificaci√≥n de Tri√°ngulos",
            b1_class_desc: "Un tri√°ngulo puede tener dos nombres a la vez:",
            b1_class_sides: "Seg√∫n los <strong>lados</strong>: Equil√°tero, Is√≥sceles, Escaleno.",
            b1_class_angles: "Seg√∫n los <strong>√°ngulos</strong>: Acut√°ngulo, Rect√°ngulo, Obtus√°ngulo.",
            b1_important: "IMPORTANTE: En esta unidad nos centraremos en el Tri√°ngulo Rect√°ngulo (tiene un √°ngulo de 90¬∞).",
            ex1_title: "Ejercicio R√°pido 1",
            ex1_q: "¬øSi un tri√°ngulo tiene un √°ngulo de 90¬∞ y dos lados iguales, c√≥mo se llama?",
            opt_a: "Rect√°ngulo y Escaleno",
            opt_b: "Rect√°ngulo e Is√≥sceles",
            opt_c: "Obtus√°ngulo e Is√≥sceles",
            b1_sub_angles: "1.1.1 Clasificaci√≥n de tri√°ngulos por √Ångulos",
            opt_acut: "Acut√°ngulo",
            opt_rect: "Rect√°ngulo",
            opt_obt: "Obtus√°ngulo",
            b1_sub1: "1.1.2 Clasificaci√≥n de tri√°ngulos por Lados",
            dd_instr: "Juego: Selecciona una etiqueta y col√≥cala bajo el tri√°ngulo correcto.",
            perim_def: "Es la longitud del contorno. Imagina que tienes que comprar alambre para cercar un jard√≠n.",
            area_def: "Es la superficie de dentro. Imagina que tienes que comprar rollos de c√©sped para cubrir el suelo.",
            b1_sub2: "1.1.3 √Årea y Per√≠metro",
            rev_ex1_title: "A. El Cuadrado (Texto)",
            rev_ex1_desc: "Tenemos un cuadrado de lado 5 cm.",
            rev_ex2_title: "B. El Tri√°ngulo (Texto)",
            rev_ex2_desc: "Un tri√°ngulo tiene base = 10 m y altura = 4 m.",
            rev_p1_title: "C. El Cubo",
            rev_p1_desc_v15: "Calcula el √°rea y el per√≠metro de <strong>una cara</strong> de este cubo de Rubik.",
            rev_p2_title: "D. La Se√±al",
            rev_p2_desc: "Se√±al triangular equil√°tera.",
            rev_circle_title: "E. La Circunferencia",
            rev_circle_desc: "Usa $\\pi = 3.14$",
            // ROOTS
            roots_title: "1.2 La Ra√≠z Cuadrada",
            roots_desc: "La operaci√≥n contraria al Cuadrado",
            roots_def: "La ra√≠z cuadrada ($\\sqrt{x}$) responde a la pregunta: <strong>\"¬øQu√© n√∫mero multiplicado por s√≠ mismo da este resultado?\"</strong>",
            roots_q3: "¬øLa ra√≠z de 15 es exacta?",
            // HIST
            hist_main_title: "üèõÔ∏è Pit√°goras: Mito y Leyenda",
            hist_intro: "La Hermandad Pitag√≥rica era una especie de \"secta\" matem√°tica. Ten√≠an normas muy extra√±as y secretos peligrosos. Haz clic para descubrirlos.",
            hist_btn_1: "El Misterio de las Habas",
            hist_btn_2: "Un Secreto Mortal",
            hist_beans_t: "La Prohibici√≥n Sagrada",
            hist_beans_d: "Los pitag√≥ricos eran vegetarianos, pero ten√≠an una norma estricta: <strong>\"¬°No comas habas!\"</strong>. Cre√≠an que las habas conten√≠an las almas de los muertos o que se parec√≠an demasiado a los seres humanos. La leyenda dice que Pit√°goras muri√≥ porque, huyendo de unos enemigos, se encontr√≥ un campo de habas y se neg√≥ a cruzarlo para no pisarlas, y all√≠ lo atraparon.",
            hist_death_t: "El Crimen de Hipaso",
            hist_death_d: "Los pitag√≥ricos cre√≠an que \"todo es n√∫mero\" (fracciones exactas). Pero un alumno, Hipaso de Metaponto, descubri√≥ que la ra√≠z de 2 ($\\sqrt{2}$) no se pod√≠a escribir como una fracci√≥n. Esto destru√≠a su teor√≠a del mundo perfecto. Dice la leyenda que, para mantener el secreto, los otros alumnos <strong>lo lanzaron por la borda de un barco</strong> en medio del mar.",
            // ANATOMY
            b2_title: "2. Identificaci√≥n Visual",
            b2_desc: "Haz clic en la Hipotenusa. F√≠jate d√≥nde est√° el √°ngulo recto.",
            b2_theory_title: "¬øC√≥mo identificar las partes?",
            b2_catet: "üî¥ <strong>Catetos:</strong> Son los dos lados que se tocan formando el √°ngulo recto. Forman una \"L\".",
            b2_hypo: "üîµ <strong>Hipotenusa:</strong> Es el lado opuesto al √°ngulo recto. No lo toca. Siempre es el lado m√°s largo.",
            b3_title: "3. El Teorema de Pit√°goras",
            vproof_title: "Demostraci√≥n Visual (Sin Palabras)",
            vproof_desc: "Observa los dos cuadrados grandes. Son iguales. ¬øQu√© pasa con el espacio vac√≠o?",
            vproof_concl: "Conclusi√≥n: El espacio vac√≠o es el mismo.",
            vproof_txt1: "Si ponemos los tri√°ngulos en las esquinas... queda el cuadrado de la HIPOTENUSA ($h^2$).",
            vproof_txt2: "Si juntamos los tri√°ngulos... quedan los cuadrados de los CATETOS ($c_1^2$ y $c_2^2$).",
            b3_trans: "\"El √°rea del cuadrado grande (hipotenusa) es igual a la suma de las √°reas de los dos cuadrados peque√±os (catetos).\"",
            calc_formulas_title: "Gu√≠a de C√°lculo",
            calc_hypo_q: "¬øBuscas la HIPOTENUSA?",
            calc_hypo_tip: "SUMAMOS (+)",
            calc_cat_q: "¬øBuscas un CATETO?",
            calc_cat_tip: "RESTAMOS (-)",
            b3_drill_title: "Pr√°ctica de C√°lculo",
            b4_title: "4. Problemes Reals",
            b4_intro: "Resuelve estos 14 problemas. Haz un dibujo en tu cuaderno si lo necesitas.",
            btn_check: "Comprobar",
            ok: "¬°Correcto!",
            ko: "Int√©ntalo de nuevo",
            b4_challenge_title: "üåü Actividad Evaluable: ¬°Sed los Profesores!",
            b4_challenge_desc: "<strong>Fase 1: Parejas.</strong> Cada uno inventa 1 problema y el compa√±ero lo resuelve.<br><br><strong>Fase 2: Grups de 4.</strong> Elegid el mejor problema de los 4.<br><br><strong>Fase 3: Preparaci√≥n.</strong> Pulid el enunciado y la soluci√≥n.<br><br><strong>Fase 4: Pizarra.</strong> Salid a explicarlo como profesores: plantead, preguntad a la clase y resolved paso a paso.",
            ext_title: "üöÄ Nivel Experto: Ternas Pitag√≥ricas",
            ext_desc: "¬øHas acabado todos los ejercicios? Descubre el secreto de los egipcios para calcular sin calculadora.",
            ext_btn_unlock: "Desbloquear Nivel Experto",
            ext_hist_title: "Los Egipcios y la Cuerda de 12 Nudos",
            ext_hist_txt: "Hace miles de a√±os, los agrimensores egipcios (los \"estiradores de cuerda\") usaban una cuerda con 12 nudos a la misma distancia. Si formaban un tri√°ngulo poniendo 3 nudos en un lado, 4 en el otro y 5 en la diagonal, consegu√≠an un √°ngulo recto perfecto para construir pir√°mides. ¬°Eso es la terna (3, 4, 5)!",
            ext_fam_title: "Familias de Ternas",
            ext_fam_prim: "<strong>Ternas Primitivas:</strong> Son los \"padres\" de todas las dem√°s. Las m√°s famosas son (3, 4, 5), (5, 12, 13) y (8, 15, 17).",
            ext_fam_deriv: "<strong>Ternas Derivadas:</strong> Si coges una terna primitiva y multiplicas sus tres n√∫meros por el mismo n√∫mero (x2, x3, x10...), obtienes una nueva terna que tambi√©n funciona.",
            ext_lab_title: "Laboratorio de Ternas",
            ext_lab_desc: "Introduce 3 n√∫meros y te dir√© si forman un tri√°ngulo rect√°ngulo perfecto.",
            ext_lab_btn: "Analizar",
            ext_chal_title: "El Reto de los Egipcios",
            ext_chal_desc: "Si la terna (3, 4, 5) funciona... ¬øqu√© pasa si la multiplicamos por 2? Calcula los lados resultantes.",
            ext_chal_concl: "‚úÖ ¬°Muy bien! Has encontrado una derivada multiplicando la terna primitiva por 2.",
            rp_1_txt: "1. Una escalera de 5m se apoya en la pared. El pie est√° a 3m de la pared. ¬øA qu√© altura llega la escalera?",
            rp_2_txt: "2. Un campo de f√∫tbol mide 90m x 120m. ¬øCu√°nto mide la diagonal que corre el √°rbitro de un c√≥rner al otro?",
            rp_3_txt: "3. Estoy en el parque de aventuras a punto de lanzarme por una tirolina. La plataforma de salida est√° en la copa de un √°rbol de 15 metros de altura. Mi instructor me espera abajo, a una distancia de 8 metros del tronco del √°rbol. ¬øCu√°ntos metros recorrer√© volando por el cable?",
            rp_4_txt: "4. En el skatepark del barrio han construido una rampa gigante. La superficie por donde patinas (la rampa inclinada) mide 5 metros de largo, y cuando llegas arriba de todo est√°s a 3 metros de altura del suelo. ¬øQu√© distancia horizontal ocupa esta rampa en el suelo?",
            rp_5_txt: "5. Quiero comprar una televisi√≥n nueva para mi habitaci√≥n. En la caja pone que es de 50 pulgadas (eso es la diagonal de la pantalla). Si cojo la cinta m√©trica y veo que el ancho es de 40 pulgadas, ¬øqu√© altura tiene la pantalla?",
            rp_6_txt: "6. Para ir al instituto, Mar√≠a siempre hace el mismo camino: camina 300 metros hacia el Norte y despu√©s gira y camina 400 metros hacia el Este. Hoy se ha levantado tarde y decide cruzar el c√©sped del parque en l√≠nea recta (la diagonal). ¬øCu√°ntos metros caminar√° hoy?",
            rp_7_txt: "7. Hemos ido de camping y estamos montando una tienda de campa√±a tipo 'tipi'. Tiene un palo central que mide 2 metros de alto. Tenemos que clavar los tensores (cuerdas) al suelo a una distancia de 1.5 metros del palo. ¬øQu√© longitud debe tener la cuerda tensa?",
            rp_8_txt: "8. Est√°s haciendo volar una cometa en la playa y has soltado 17 metros de hilo. Justo en ese momento, la cometa est√° volando exactamente encima de una fuente que se encuentra a 8 metros de donde est√°s t√∫. ¬øA qu√© altura est√° volando la cometa?",
            rp_9_txt: "9. Un ingeniero tiene que sujetar una gran antena de radio que mide 24 metros de altura. Quiere poner un cable de seguridad desde la punta de arriba hasta un bloque de hormig√≥n que est√° a 7 metros de la base. ¬øCu√°ntos metros de cable necesita comprar?",
            rp_10_txt: "10. Tenemos un problema con la mudanza. Tenemos un armario tumbado en el suelo que mide 2.4 metros de alto y 0.7 metros de fondo. El techo de la habitaci√≥n est√° a 2.6 metros. Si intentamos levantar el armario poni√©ndolo de pie, ¬øla diagonal tocar√° en el techo? Calcula cu√°nto mide la diagonal del armario.",
            rp_11_txt: "11. Te has comprado una funda para tu nueva tablet. La pantalla mide 12 cm de ancho y 9 cm de alto. El fabricante de fundes te pide la medida de la diagonal para saber si cabe. ¬øCu√°ntos cm hace la diagonal?",
            rp_12_txt: "12. Es de noche y una farola de la calle de 4 metros de altura proyecta una sombra muy larga en el suelo, de 3 metros. Si tuvi√©ramos que tirar un hilo desde la bombilla de la farola hasta la punta de la sombra, ¬øcu√°nto medir√≠a?",
            rp_13_txt: "13. Pap√° quiere saber si su coche nuevo cabe en diagonal en la plaza de parking. La plaza mide 2.5 metros de ancho y 6 metros de largo. ¬øCu√°l es la distancia m√°xima en diagonal que hay en la plaza?",
            rp_14_txt: "14. El abuelo tiene un huerto rectangular vallado. Sabemos que la diagonal que cruza el huerto mide 10 metros y que uno de los lados mide 6 metros. El abuelo quiere saber cu√°ntos metros mide el otro lado para plantar tomateras. Calc√∫lalo.",
            btn_next_sec: "¬°He acabado! Siguiente Secci√≥n üîì"
        }
    };

    let lang = 'ca';
    let selectedLabel = null;
    let currentLevel = 1; // 1 = Only Sec 1 open

    // --- AUTO-SAVE & RESTORE SYSTEM ---

    document.addEventListener('DOMContentLoaded', () => {
        loadProgress();
    });

    document.body.addEventListener('input', (e) => {
        if(e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
            if(e.target.id) {
                localStorage.setItem('math_v13_' + e.target.id, e.target.value);
            }
        }
    });

    // --- RESET FUNCTION ---
    function resetProgress() {
        if(confirm(lang === 'ca' ? "Est√†s segur que vols esborrar tot el progr√©s i comen√ßar de zero?" : "¬øEst√°s seguro de que quieres borrar todo el progreso y empezar de cero?")) {
            // Clear only our keys to avoid messing with other sites
            Object.keys(localStorage).forEach(key => {
                if(key.startsWith('math_v13_')) {
                    localStorage.removeItem(key);
                }
            });
            location.reload();
        }
    }

    // --- PROGRESSIVE UNLOCKING ---
    function unlockSection(levelToUnlock) {
        if(levelToUnlock > currentLevel) {
            currentLevel = levelToUnlock;
            localStorage.setItem('math_v13_level', currentLevel);
            applyLocks();
            // Scroll to the new section
            document.getElementById('sec_' + levelToUnlock).scrollIntoView({behavior: 'smooth'});
        }
    }

    function applyLocks() {
        // Unlock logic
        for (let i = 2; i <= 4; i++) {
            const sec = document.getElementById('sec_' + i);
            const content = document.getElementById('content_' + i);
            const lockIcon = sec.querySelector('.lock-icon');
            
            if (i <= currentLevel) {
                // Unlock
                sec.classList.remove('locked-section');
                content.style.display = 'block';
                if(lockIcon) lockIcon.style.display = 'none';
            } else {
                // Lock
                sec.classList.add('locked-section');
                content.style.display = 'none';
                if(lockIcon) lockIcon.style.display = 'inline';
            }
        }
    }

    function loadProgress() {
        // A. Restore Language
        const savedLang = localStorage.getItem('math_v13_lang');
        if(savedLang && savedLang !== lang) {
            toggleLanguage();
        }

        // B. Restore Extension State
        if(localStorage.getItem('math_v13_expert') === 'true') {
            document.getElementById('extension-content').style.display = 'block';
            document.getElementById('btn_expert').style.display = 'none';
        }

        // C. Restore Level (Locks)
        const savedLevel = localStorage.getItem('math_v13_level');
        if(savedLevel) {
            currentLevel = parseInt(savedLevel);
        }
        applyLocks();

        // D. Restore Inputs & Selects
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(el => {
            const savedVal = localStorage.getItem('math_v13_' + el.id);
            if(savedVal) el.value = savedVal;
        });

        // E. Restore Drag & Drop
        const ddBoxes = ['box1', 'box2', 'box3'];
        ddBoxes.forEach(boxId => {
            const savedType = localStorage.getItem('math_v13_dd_' + boxId);
            if(savedType) {
                const box = document.getElementById(boxId);
                const label = document.getElementById('lbl_' + savedType);
                if(label && box) {
                    box.innerText = label.innerText;
                    box.classList.add('filled');
                    label.classList.add('hidden');
                }
            }
        });
    }

    // --- MAIN FUNCTIONS ---

    function toggleLanguage() {
        lang = lang === 'ca' ? 'es' : 'ca';
        localStorage.setItem('math_v13_lang', lang);
        
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if(t[lang][key]) el.innerHTML = t[lang][key];
        });
        if(window.MathJax) MathJax.typeset();
    }

    function startDossier() {
        document.getElementById('sec_1').classList.remove('locked-section');
        document.getElementById('content_1').style.display = 'block';
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('sec_1').scrollIntoView({behavior: 'smooth'});
    }

    // --- CHECK EX 1 ---
    function checkEx1() {
        const val = document.getElementById('ex1_input').value;
        const fb = document.getElementById('ex1_feed');
        if(val === 'b') { fb.innerHTML = t[lang].ok; fb.className = "feedback correct"; }
        else { fb.innerHTML = t[lang].ko; fb.className = "feedback incorrect"; }
    }

    // --- CHECK ANGLES ---
    function checkAngles() {
        const a1 = document.getElementById('angle_1').value; // acut
        const a2 = document.getElementById('angle_2').value; // rect
        const a3 = document.getElementById('angle_3').value; // obt
        
        const f1 = document.getElementById('f_angle_1');
        const f2 = document.getElementById('f_angle_2');
        const f3 = document.getElementById('f_angle_3');

        f1.innerHTML = (a1 === 'acut') ? "‚úÖ" : "‚ùå";
        f2.innerHTML = (a2 === 'rect') ? "‚úÖ" : "‚ùå";
        f3.innerHTML = (a3 === 'obt') ? "‚úÖ" : "‚ùå";
    }

    // --- DRAG & DROP LOGIC ---
    function selectLabel(type) {
        selectedLabel = type;
        document.querySelectorAll('.dd-label').forEach(el => el.classList.remove('selected'));
        document.getElementById('lbl_' + type).classList.add('selected');
    }

    function placeLabel(boxId) {
        if (!selectedLabel) return;
        const box = document.getElementById(boxId);
        const correctType = box.getAttribute('data-correct');
        const feedback = document.getElementById('dd_feedback');

        if (selectedLabel === correctType) {
            box.innerText = document.getElementById('lbl_' + selectedLabel).innerText;
            box.classList.add('filled');
            document.getElementById('lbl_' + selectedLabel).classList.add('hidden');
            feedback.innerText = t[lang].ok; feedback.className = "feedback correct";
            
            localStorage.setItem('math_v13_dd_' + boxId, correctType);

        } else {
            feedback.innerText = t[lang].ko; feedback.className = "feedback incorrect";
            setTimeout(() => { feedback.innerText = ""; }, 1500);
        }
        selectedLabel = null;
        document.querySelectorAll('.dd-label').forEach(el => el.classList.remove('selected'));
    }

    // --- REVIEW CHECKERS ---
    function checkRevText1() {
        const p = parseFloat(document.getElementById('rev_text_1_p').value);
        const a = parseFloat(document.getElementById('rev_text_1_a').value);
        const fb = document.getElementById('feed_rev_text_1');
        if (p === 20 && a === 25) { fb.innerHTML = t[lang].ok; fb.className="feedback correct"; }
        else { fb.innerHTML = t[lang].ko; fb.className="feedback incorrect"; }
    }

    function checkRevText2() {
        const a = parseFloat(document.getElementById('rev_text_2_a').value);
        const fb = document.getElementById('feed_rev_text_2');
        if (a === 20) { fb.innerHTML = t[lang].ok; fb.className="feedback correct"; }
        else { fb.innerHTML = t[lang].ko; fb.className="feedback incorrect"; }
    }

    function checkRevVisual1() {
        const p = parseFloat(document.getElementById('ans_rev1_p').value);
        const a = parseFloat(document.getElementById('ans_rev1_a').value);
        const fb = document.getElementById('feed_rev_vis_1');
        // Cube face: side 1.5*3=4.5. Area=20.25. Perim=18
        if (p === 18 && a === 20.25) { fb.innerHTML = t[lang].ok; fb.className="feedback correct"; }
        else { fb.innerHTML = lang==='ca' ? "Pista: Costat gran = 1.5 x 3 = 4.5" : "Pista: Lado grande = 1.5 x 3 = 4.5"; fb.className="feedback incorrect"; }
    }

    function checkRevVisual2() {
        const p = parseFloat(document.getElementById('ans_rev2_p').value);
        const a = parseFloat(document.getElementById('ans_rev2_a').value);
        const fb = document.getElementById('feed_rev_vis_2');
        if (p === 180 && a === 1560) { fb.innerHTML = t[lang].ok; fb.className="feedback correct"; }
        else { fb.innerHTML = lang==='ca' ? "Pista: √Ärea = (60 x 52) / 2" : "Pista: √Årea = (60 x 52) / 2"; fb.className="feedback incorrect"; }
    }

    function checkRevCircle() {
        const p = parseFloat(document.getElementById('ans_rev_circle_p').value);
        const a = parseFloat(document.getElementById('ans_rev_circle_a').value);
        const fb = document.getElementById('feed_rev_circle');
        // r=5. Area=3.14*25=78.5. Length=2*3.14*5=31.4
        // Allow tiny margin
        if ( (p>=31.3 && p<=31.5) && (a>=78.4 && a<=78.6) ) { 
            fb.innerHTML = t[lang].ok; fb.className="feedback correct"; 
        } else { 
            fb.innerHTML = t[lang].ko; fb.className="feedback incorrect"; 
        }
    }

    // --- CHECK ROOT EXERCISES ---
    function checkRoot1() {
        const v = parseFloat(document.getElementById('sq_1').value);
        document.getElementById('f_sq_1').innerHTML = (v === 7) ? "‚úÖ" : "‚ùå";
    }
    function checkRoot2() {
        const v = parseFloat(document.getElementById('sq_2').value);
        document.getElementById('f_sq_2').innerHTML = (v === 9) ? "‚úÖ" : "‚ùå";
    }
    function checkRoot3() {
        const v = document.getElementById('sq_3').value;
        document.getElementById('f_sq_3').innerHTML = (v === 'no') ? "‚úÖ" : "‚ùå";
    }

    // --- ROOTS MODAL LOGIC ---
    function openRootsModal() {
        document.getElementById('rootsModal').style.display = 'block';
    }
    function closeRootsModal() {
        document.getElementById('rootsModal').style.display = 'none';
    }
    // Close modal if clicked outside
    window.onclick = function(event) {
        let modal = document.getElementById('rootsModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // --- MINI CALCULATOR LOGIC ---
    function calculateRoot() {
        let input = document.getElementById('calc_input').value;
        let resultSpan = document.getElementById('calc_result');
        if (input === "") return;
        let val = parseFloat(input);
        if (val < 0) {
            resultSpan.innerHTML = "Error";
            resultSpan.style.color = "#c0392b";
        } else {
            let res = Math.sqrt(val);
            // Format nicely: if integer, show integer. If float, show 2 decimals.
            let formatted = Number.isInteger(res) ? res : res.toFixed(2);
            resultSpan.innerHTML = formatted;
            resultSpan.style.color = "#f1c40f";
        }
    }

    // --- HYPO GAME ---
    function correct(el) {
        el.setAttribute("stroke", "#27ae60");
        document.getElementById("game_msg").innerText = t[lang].ok;
        document.getElementById("game_msg").style.color = "green";
    }
    function wrong(el) {
        el.setAttribute("stroke", "#c0392b");
        document.getElementById("game_msg").innerText = lang==='ca' ? "No, aix√≤ √©s un catet" : "No, eso es un cateto";
        document.getElementById("game_msg").style.color = "red";
    }

    // --- HISTORY TOGGLE ---
    function toggleHistory(id) {
        document.getElementById('h_beans').style.display = 'none';
        document.getElementById('h_death').style.display = 'none';
        document.getElementById(id).style.display = 'block';
    }

    // --- DRILL ---
    function checkDrill() {
        const answers = [5, 6, 13, 5, 10, 12];
        for(let i=1; i<=6; i++) {
            const val = parseFloat(document.getElementById('c_'+i).value);
            const span = document.getElementById('r_'+i);
            if(val === answers[i-1]) { span.innerHTML = "‚úÖ"; } else { span.innerHTML = "‚ùå"; }
        }
    }

    // --- REAL PROBLEMS ---
    function checkRealText() {
        const sol = [4, 150, 17, 4, 30, 500, 2.5, 15, 25, 2.5, 15, 5, 6.5, 8];
        for(let i=1; i<=14; i++) {
            const val = parseFloat(document.getElementById('rp_'+i).value);
            const span = document.getElementById('f_rp_'+i);
            if(val === sol[i-1]) { span.innerHTML = "‚úÖ"; } else { span.innerHTML = "‚ùå"; }
        }
    }

    // --- EXTENSION ---
    function toggleExtension() {
        const el = document.getElementById('extension-content');
        if(el.style.display === 'none') {
            el.style.display = 'block';
            document.getElementById('btn_expert').style.display = 'none';
            localStorage.setItem('math_v13_expert', 'true');
        }
    }

    function checkUserTriple() {
        const a = parseFloat(document.getElementById('t_user_a').value);
        const b = parseFloat(document.getElementById('t_user_b').value);
        const c = parseFloat(document.getElementById('t_user_c').value);
        const fb = document.getElementById('fb_user_triple');
        
        if(!a || !b || !c) return;
        const arr = [a,b,c].sort((x,y)=>x-y);
        
        if(Math.abs(arr[0]*arr[0] + arr[1]*arr[1] - arr[2]*arr[2]) < 0.001) {
            fb.innerHTML = "‚ú® S√ç! √âs una Terna Pitag√≤rica!";
            fb.className = "feedback correct";
        } else {
            fb.innerHTML = "‚ùå No. Prova amb altres nombres.";
            fb.className = "feedback incorrect";
        }
    }

    function checkTripleMulti() {
        const t1 = parseFloat(document.getElementById('t_1').value);
        const t2 = parseFloat(document.getElementById('t_2').value);
        const t3 = parseFloat(document.getElementById('t_3').value);
        const fb = document.getElementById('fb_t1');
        
        if(t1===6 && t2===8 && t3===10) {
            fb.innerHTML = t[lang].ext_chal_concl;
            fb.className = "feedback correct";
        } else {
            fb.innerText = "‚ùå";
            fb.className = "feedback incorrect";
        }
    }
</script>

</body>
</html>
